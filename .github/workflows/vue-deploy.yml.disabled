name: Vue Deploy

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:
    inputs:
      environment:
        description: 'é¸æ“‡ç’°å¢ƒ'
        required: true
        default: 'dev'
        type: choice
        options:
        - dev
        - staging
        - production

jobs:
  vue-build:
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment || 'dev' }}

    steps:
    - uses: actions/checkout@v4

    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        # cache: 'npm' # ç§»é™¤ cacheï¼Œå› ç‚ºæ²’æœ‰ lock file

    - name: Install Dependencies
      run: |
        if [ -f "package.json" ]; then
          npm install
        else
          echo "âš ï¸ No package.json found. Skipping install for test demo."
        fi

    - name: ðŸ—ï¸ Build Application
      env:
        # æ³¨å…¥å‰ç«¯éœ€è¦çš„ VITE_ è®Šæ•¸
        VITE_APP_ENV: ${{ vars.APP_ENV }}
        VITE_API_URL: ${{ vars.REGISTRY_URL }}
        DEBUG_MODE: ${{ vars.DEBUG_MODE }}
      run: |
        echo "=== Mocking Build Process for Vue App ==="
        echo "Environment: $VITE_APP_ENV"
        echo "API URL: $VITE_API_URL"
        
        # å»ºç«‹ .env ä¾› build éŽç¨‹è®€å– (å¦‚éœ€è¦)
        echo "VITE_APP_ENV=$VITE_APP_ENV" >> .env
        echo "VITE_API_URL=$VITE_API_URL" >> .env
        
        echo "=== Generated .env content ==="
        cat .env
        
        # æ¨¡æ“¬ Build
        if [ -f "package.json" ]; then
           npm run build --if-present
        else
           echo "âœ… Mock build completed (No actual project)."
        fi
