name: Vue Deploy

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:
    inputs:
      environment:
        description: 'é¸æ“‡ç’°å¢ƒ'
        required: true
        default: 'dev'
        type: choice
        options:
        - dev
        - staging
        - production

jobs:
  vue-build:
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment || 'dev' }}

    steps:
    - uses: actions/checkout@v4

    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: Install Dependencies
      run: npm install # ä½¿ç”¨ npm ci é€šå¸¸æ›´å¥½ï¼Œä½†åœ¨æ¸¬è©¦ç’°å¢ƒ npm install è¼ƒå¯¬å®¹

    - name: ðŸ—ï¸ Build Application
      env:
        # æ³¨å…¥å‰ç«¯éœ€è¦çš„ VITE_ è®Šæ•¸
        VITE_APP_ENV: ${{ vars.APP_ENV }}
        VITE_API_URL: ${{ vars.REGISTRY_URL }} # ç¯„ä¾‹ï¼šä½¿ç”¨å·²æœ‰è®Šæ•¸æ¨¡æ“¬ API URL
        DEBUG_MODE: ${{ vars.DEBUG_MODE }}
      run: |
        echo "=== Building Vue App ==="
        echo "Environment: $VITE_APP_ENV"
        
        # å»ºç«‹ .env ä¾› build éŽç¨‹è®€å– (å¦‚éœ€è¦)
        echo "VITE_APP_ENV=$VITE_APP_ENV" >> .env
        echo "VITE_API_URL=$VITE_API_URL" >> .env
        
        # åŸ·è¡Œ Build (å¦‚æžœ script å­˜åœ¨)
        npm run build --if-present
